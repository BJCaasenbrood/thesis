%\cleardoublepage
\newpage
\section{On modal truncation: applying reduced-order model-based controllers to high-dimensional models of continuum soft robots}
In the previous section, we made the assumption that the truncation order $k$ of both the dynamic system and the controller is identical. However, in practical scenarios, this is never the case. Soft robots are, in theory, infinite-dimensional systems that can never be precisely matched by a finite state description. This brings forth several issues regarding the selection of an appropriate truncation controller and the potential consequences of an unsuitable truncation choice, such as a deterioration in control performance or even instability.
%

In light of this, we will examine the impact on performance resulting from varying truncation levels of the model-based controller \eqref{eq:C3:control} when applied to high-dimensional Cosserat models (\ie, an attempt towards approximating infinite dimensionality). To distinguish between the two, let us introduce $k_{\textrm{sys}}$ (\ie, the truncation of the "true" system) and $k:= k_{\textrm{control}}$ (\ie, the truncation of the controller), with the condition that $k_{\textrm{sys}} \gg k_{\textrm{control}}$. In order to maintain computational feasibility, we set $k_\textrm{sys} = 8^2$, \ie, the truncation order at which numerical convergence is observed in Example \ref{ex:C3:convergence}. We denote the controller states as $\q_c$ and system states as $\q$. Despite the difference in dimensions between the soft robot and the controller, \ie, $\dim(\q) \gg \dim(\q_c)$, we can interconnect the two systems by ensuring that the input and output have appropriate dimensions. For simplicity, we choose an actuation map for the controller, denoted as $\mat{G}_k = \IB_6 \otimes \IB_k$, and for the system, denoted as $\mat{G} = \IB_6 \otimes \textrm{holdcol}_{1:k}\left( \IB_{k_{\textrm{sys}}}\right)$, where $\textrm{holdcol}_{i:j}(\cdot)$ holds all columns from $i$ to $j$ while setting any other columns to zero. Hence it follows that $\dim(\uB) = \rank(\GB) = \rank(\GB_k) = 6k$.

Since we cannot measure $\q$ directly, we propose a controller-observer architecture that estimates the controller states $\q_c$ based on available measurements. Assuming we can measure the end-effector position via sensor system $\Sigma_{\textrm{sensor}}$, \ie, $\yB = \gammaB_L(\q)$, we consider a energy-shaping controller plus observer approach $\Sigma_{\textrm{control}}$ as follows (see Figure \ref{fig:C3:diagram_control} for the control diagram):
\begin{align}
  \Sigma_{\textrm{control}}:
  \begin{dcases}
    \vspace{2mm}
    \uB  = \GB_k^+ \left( \nabla_{\vec{q}_c}{\Hm} - \nabla_{\vec{q}_c}{\Hm}_d \right), \\ 
    \dot{\tilde{\qB}} = L_1 \JB_v^\top\!\eB + L_2 (\IB - \JB_v^\dag\JB_v) \nabla_{\q_c} \Psi,
  \end{dcases}
\end{align}
%
%
\begin{figure}[!t]
  %\vspace{-4mm}
  \centering
  %\input{chapter1/chapter1}
  \input{./fig/fig_C4_InfD_diagram.pdf_tex}
  \vspace{-2mm}
   %\includegraphics[width = 0.99\textwidth]{fig_C2_PBAdiagram.tex}
  \caption{\small Schematic diagram of the low-order energy-based controller and observer applied to the \textit{"true"} soft robot system depicted as $\Sigma_{\textrm{softrobot}}$. (a) Control diagram showing the interconnection between the observer, controller, and the soft robot. The block $\Sigma_{\textrm{sensor}}$ provides online measurements of the end-effector position $\gamma_B$. The observer estimates are used to compute the control law \eqref{eq:C3:control}. (b) The observer produces an estimate $\tilde{\q}$ based on a measurement error $\eB$ and the control signals $\uB$. Here, $\textrm{FK}$ is the forward kinematic mapping derived using \eqref{eq:C3:mappingSE3g}.}
  \label{fig:C3:diagram_control}
  \vspace{-3mm}
\end{figure}
%
where $\tilde{\q}$ is the controller state estimation, $\eB = \yB - \tilde{\gammaB}_L$ represents the difference between the true end-effector location and its estimate produced by the observer model, $\JB_v$ the linear velocity part of the Jacobian matrix, $\ten{N} = (\IB - \JB_v^\dag\JB_v)$ the null space, $\Psi$ a scalar-valued function that represents a sub-task for the observer, and $L_1,L_2 > 0$ are the observer gains. We select a sub-task energy potential $\Psi$ as the difference between the estimated potential energy and the work produced by the control input $\uB$, thus $\nabla{\q_c} \Psi(\tilde{\q},\uB) = \nabla_{\q_c}\mathcal{H}(\tilde{\q}) - \GB_k \uB$. Thus, the observer is nothing more than a continuous-time continuum deformation solver.%, aimed at finding a stable curve configuration given a known end-effector position and input $\uB$.
%
\begin{figure*}[!t]
  \centering
  \vspace{-2mm}
  %\input{./3_chapters/3_chapter/img/fig_C3_3D_srmarm.tex}
  \includegraphics*[width=1.04\textwidth]{./pdf/thesis-figure-5-13.pdf}
  \vspace{-5mm}
  \caption{\small Three-dimensional evolution of the high-dimensional soft robotic system subject to a low-dimensional controller. The truncation order is indicated by $k$. The figure displays the true system as (\textcolor{matinfil!50}{$\blacksquare$}) and the low-dimensional shape estimations as (\textcolor{lightblue}{$\blacksquare$}). Notice that, independent of the truncation order $k$, all controllers converge to a neighborhood of the setpoint even when the estimates are off. }
  \label{fig:C3:softarm_3D_truncation}
  \vspace{-6mm}
\end{figure*}

\renewcommand\arraystretch{1.15}
\begin{table}[b]
  %\vspace{-0.25cm}
  \setlength\tabcolsep{0.44em}
  \caption{\small Error values in the steady-state condition for the energy-based controller are examined as the model truncation $k$ increases. It is noteworthy that as the value of $k$ increases, the accuracy of the backbone estimate improves. However, when it comes to the tip error, a consistent and monotonic trend with increasing $k$ may not be observed.}
  \label{tab:C3:EX3:error} \centering
  \rowcolors{0}{}{blue!5}
  \begin{tabular}{l||cccccccc}
    \hline
    Truncation & $k=1$ & $k=2$ & $k=3$ & $k=4$ & $k=5$ & $k=6$ & $k=7$ & $k=8$ \\
    \hline 
    \hline
    Tip error (mm) & 14.68 & 2.36 & 0.73 & 0.65 & 0.46 & 0.78 & 0.65 & 0.54\\
    Curve error & 118\% & 16.1\% & 14.2\% & 8.34\% & 5.31\% & 4.53\% & 4.24\% & 4.01\% \\
    \hline
  \end{tabular}
  \end{table}
%

%
We again consider the soft robot inspired by the octopus arm (see Table \ref{tab:C3:parameters1}) with the controller-observer gains: $\lambda_1 = \lambda_2 = 0.1$ and $L_1 = L_2 = 1$. The desired end-effector configuration is $\PhiB_d = \IB_3$ and $\gammaB_d = (70, 0, 40)^\top$. In this study, we analyze the performance of the reduced-order controller for truncation orders $k \in \{1,2,...,8\}$. Note that for $k=1$, the controller explores the "\emph{Piece-wise Constant Strain}" (PCS) assumption similar to Chapter \ref{chap:PCC}, while the true system $\Sigma_{\textrm{softrobot}}$ is not impeded by such kinematic restrictions. %

The numerical simulations conducted for the controller benchmark are presented in Figure \ref{fig:C3:softarm_3D_truncation}, showcasing snapshots of the closed-loop system in operation. The figure displays the true system as (\textcolor{matinfil!50}{$\blacksquare$}) and the low-dimensional shape estimations as (\textcolor{lightblue}{$\blacksquare$}). Figure \ref{fig:C3:EX3:gamma_order} shows the trajectories of $\gammaB_L$ for various $k$, while Figure \ref{fig:C3:EX3:backbone_convergence} shows the RMS error between the backbone of the estimate and the true system. The steady-state values for these metrics are reported in Table \ref{tab:C3:EX3:error}. As anticipated, it is observed that with increasing $k$, the differences between the true system and shape estimates diminish, indicating a monotonically increasing precision. However, a few other remarkable observations can be made.

\begin{figure}[!t]
\centering
\vspace{-3mm}
%\input{./fig/fig_infdim_gamma.tex} 
\includegraphics*[width=\textwidth]{./pdf/thesis-figure-5-14.pdf}
\vspace{-3mm}
\caption{\small Temporal evolutions of the end-effector locations for increasing modal number $k$, where (left) is the $x$-position, (middle) the $y$-position, and (right) the $z$-position. The modal order is color-coded: $k \in \{\ldatanum{Matlab1}{1},\ldatanum{Matlab2}{2},\ldatanum{Matlab3}{3},\ldatanum{Matlab4}{4},\ldatanum{Matlab5}{5},\ldatanum{Matlab6}{6},\ldatanum{Matlab7}{7},\ldatanum{Matlab8}{8}\}$. Notice all, but the PCS controller ($k=1$) converges to the desired end-effector position.}
\vspace{-0.2cm}
\label{fig:C3:EX3:gamma_order}
\end{figure}

 First, irrespective of the truncation, all controllers guide the end-effector of the soft robot towards a close vicinity of the desired configuration. A particularly intriguing example is seen in the simulation for $k=1$ (\ie, PCS scenario). In this case, the desired tip configuration $\gB_d$ lies outside the workspace of the reduced controller-observer system, \ie, $\gB_d \notin \mathcal{W}_c$. Consequently, the PCS (or PCC) shape estimation is, in theory, unable to achieve the assigned control objective. However, since the true system is not constrained by the controller's conservative workspace $\mathcal{W}_c$, the closed-loop system may lead to a smaller error than any solution confined to $\mathcal{W}_c$. This discovery may reduce the importance of modal truncation (or the choice of model basis) in the performance of model-based control of soft robots, as soft robots may inherently possess enough redundancy to counteract modeling imperfections. This potentially sheds light on the reason behind the notable efficacy of PCC models in soft robot control, despite their oversimplification. The findings presented in Table \ref{tab:C3:EX3:error} appear to support this claim, as for $k \ge 3$, the tip error consistently remains within sub-millimeter precision. Achieving sub-millimeter precision for $k=1$ is perhaps possible by introduce an integral action, or explored adaptive controllers akin to those proposed in Chapter \ref{chap:PCC}.
 
Second, transitioning from $k=2 \to k=3$, a significant transformation in the stable configurations is observed. Specifically, we observe that the controller drastically switches from an "\emph{elbow down}" configuration to an "\emph{elbow up}" configuration (see Figure \ref{fig:C3:EX2:mode_convergence_3d}). We hypothesize that for low controller orders, \ie, $k \le 2$, the overall shape estimation error is too large to appropriately compensate gravity, hence an elbow-down solution is preferred. Therefore, in terms of full-body shape control, truncation might play a more important role than tip setpoint regulation.
%
%
\begin{figure}[!t]
  \centering
  %\input{./fig/fig_infdim_gamma.tex} 
  \includegraphics*[width=\textwidth]{./pdf/thesis-figure-5-15.pdf}
  \caption{Root mean square error of backbone between high-order model and low-order observer. The modal order is color-coded as follows: $k \in \{\ldatanum{Matlab1}{1},\ldatanum{Matlab2}{2},\ldatanum{Matlab3}{3},\ldatanum{Matlab4}{4},\ldatanum{Matlab5}{5},\ldatanum{Matlab6}{6},\ldatanum{Matlab7}{7},\ldatanum{Matlab8}{8}\}$. }
  %\vspace{-0.2cm}
  \label{fig:C3:EX3:backbone_convergence}
  \end{figure}
  %