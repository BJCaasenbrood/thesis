%!TEX root = ../../thesis.tex
\noindent In this section, we will discuss the simulation results of the dynamic model \eqref{eq:C2:dynamic_model}, the passivity-based controller \eqref{eq:C2:tau}, and the adaptive law \eqref{eq:C2:update}. To illustrate effectiveness and performance of the approach, we segregate our analysis into several study-cases of various complexity. First, focusing on the physical one-link soft robot in Figure \ref{fig:C2:soft_robot} ($N = 1$), we investigate the unforced system's equilibria and their corresponding stability. In continuation, we compare the simulated trajectories of the dynamical model with experimental data for natural oscillations, forced pneumatic inputs, and external loading conditions; where we also highlight contribution of the hyper-elastic FEM-driven material model. Second, to illustrate the flexibility and computational efficiency of the numerical framework, we extend the one-link model to a multi-link model with $N = 6$ soft-bodied links.

The numerical solutions to the ordinary differential equations in \eqref{eq:C2:dynamic_model} together with \eqref{eq:C2:tau} and \eqref{eq:C2:update} are computed using the aforementioned MDE integration scheme which is developed in \matlab, and the underlying code can be found at Caasenbrood et al. (2020, \cite{Caasenbrood2021}). The software architecture is compactly written as Object-Oriented class labeled under \texttt{./src/Model.m} that enables a minimal programming interface to set-up various soft robotic simulation models easily. Additionally, all numerical examples that will be discussed in this section are made available under \texttt{./examples/paper} on the repository.
%
%\subsection*{Example 1: Natural dynamics -- One-link soft robot}
\begin{example}[Natural dynamics -- One-link soft robot]
\end{example}
\noindent The following physical parameters are chosen for the soft robot: the mass $m_0 = 17.3$ g, the relaxation length $l_0 = 64.4$ mm. The material parameters for hyper-elasticity and visco-elasticity models are chosen identical to Table \ref{tab:C2:elastic_parameters}. For the additional viscous material behavior, the Rayleigh damping matrix and the creep compliance matrix are chosen a follow:
%
\begin{align}
\mat{R} & = \begin{pmatrix} 0.01 & 0 & 0 \\ 0 &  1.05\pwr{-5} & 0 \\ 0 & 0 & 1.05\pwr{-5} \end{pmatrix}; \notag \\[0.45em]
\mat{K}_{\lambda} & = \begin{pmatrix} 502.3 & 0 & 0 \\ 0 &  1.53\pwr{-2} & 0 \\ 0 & 0 & 1.53\pwr{-2} \end{pmatrix}. \notag
\end{align}
%
\noindent We stress that the values for the Rayleigh damping and creep compliance shown above are identified empirically {through} open-loop measurements, similar to the creep coefficient provided in Table \ref{tab:C2:elastic_parameters}.
%The code for the one-link simulation model can be found under \texttt{./mdl\_1\_natural.m}.
%

First, we investigate the existence and the stability of the equilibria of the unforced system. If the system is at rest (i.e., $\dq = 0$, $\ddq = 0$), then by definition there are no conservative forces acting on the system. Thus, for any equilibrium point ${\q}_0$ it holds that $\nabla \mathcal{U}({\q}^\star) \equiv \vec{0}$. If $ \mathcal{U}({\q}^\star) \equiv E_0$ is a local minimum, then the equilibrium is deemed stable. Any small disturbance will result in a new energy-state $E_1$ and will consequently bring the system in motion. However, regarding $E_0$ is a local minimum, the system will remain in a neighborhood of ${\q}^\star$ and eventually converge towards its nearest low-state energy $E_0$. If $\mathcal{U}({\q}^\star) \equiv E_0$ is a local maximum, the equilibrium is deemed to be unstable, since there exist a configuration close to ${\q}^\star$ with a lower energy-state, \ie, $\mathcal{U}({\q}^\star + {\delta}\q) < E_1$.

By analysis of the gradient of the potential energy function $\nabla \mathcal{U}({\q})$, two unique equilibria can be found numerically. The potential function has a local maximum for $\q^\star_{\textrm{unstab}}=(-\tfrac{m_0 g}{L (\alpha_1 - \alpha_2)},\,0,\,0)^\top$ which is unstable. To some extent, it is analogous to the unstable upwards equilibrium position related to the single-DOF pendulum system. For the stable equilibria, the bisection method was used to find the zero-crossing of $\nabla \mathcal{U}({\q})$, where it was found that all stable solutions of the unforced system will tend to the following set:
%
\begin{equation*}
\Omega_{\textrm{stab}} = \left\{\q\in \mathcal{Q}\;:\;\varepsilon=\varepsilon^\star,\, \kappa(\q) = \frac{\alpha^\star}{\alpha_\phi(\q)} \right\} \notag
\end{equation*}
%
with $\varepsilon^\star = -0.0021$ and $\alpha^\star = 0.0174$, which topologically equivalent to a ring. This set corresponds to the hanging position of the soft robot. It should be worth mentioning that the stable set of equilibria stems from the force balance between the internal elastic potential forces and the external gravitational potential forces, and thus any stiffness will lead to a stable set with a similar topology. By changing the base orientation of the soft manipulator (i.e., by modifying $\Phi_0$), both equilibria vanish and all state trajectories will tend to a global stable equilibrium. For fully reversing the orientation, this trivially leads to the stable equilibrium $(\varepsilon,\,\kappa_x,\,\kappa_y) = (+\tfrac{m_0 g}{L (\alpha_1 - \alpha_2)},\, 0,\, 0)$. This phenomenon is referred to as local bifurcation, in which the change of parameter values alters the existence and stability of equilibria. This property might be interesting for soft robot manipulators with multiple soft-bodied links, as they are likely to be subjected to different gravitational loads.

To illustrate the unforced dynamics and the existence of stable equilibria, time-domain simulations of the dynamical model with nonzero initial conditions:
%
\begin{align*}
\q_0 & = \left(0,\,-15,\,15\; \right)^\top, \\[0.35em] \dq_0 & = \left(0,\,2500,\,0 \right)^\top
\end{align*}
%
Figure. \ref{fig:C2:natural_states} shows the state trajectories of the soft robot; whereas Figure \ref{fig:4}b is provided to better illustrate the underlying dynamics and the trajectory of the end-effector.
%
\begin{figure}[!t]
  \vspace{-5mm}
  \centering
  \input{./3_chapters/2_chapter/img/fig_C2_natural_states.tex}
  \vspace{-3mm}
  \caption{Three-dimensional volumetric evolution of the one-link soft robot model with initial conditions $\q_0 = (0 , -15, 15)^\top$ and $\dq_0 = (0, 2500, 0)^\top$. Notice that the soft robot oscillates about the set of stable equilibria $\Omega_{\textrm{stab}}$. }
  \label{fig:C2:natural_states}
\end{figure}
%
%
\begin{figure}[!t]
  %\vspace{-3mm}
  \centering
  \input{./3_chapters/2_chapter/img/fig_C2_natural_3D.tex}
  \vspace{-3mm}
  \caption{State trajectories of one-link soft robot model with initial conditions $\q_0 = (0 , -15, 15)^\top$ and $\dq_0 = (0, 2500, 0)^\top$. The figure shows the elongation strain $\varepsilon$ and the curvatures $\kappa_x$, $\kappa_y$ in the $xz$-plane and $yz$-plane, respectively.}
  \label{fig:C2:natural_3D}
\end{figure}
%
Besides the existence of stable solutions, the numerical simulations perfectly illustrate the coupled dynamics between the elongation and bending of the soft robot. Due to the difference in mechanical stiffness for elongation and bending, we observe high-frequency and low-frequency oscillation for the elongation strain $\varepsilon(t)$, and we observe low-frequent oscillations for the curvatures $\kappa_x(t)$ and $\kappa_y(t)$. Interestingly, the low-frequency oscillations are passed from the curvature dynamics to elongation dynamics; conversely, the dynamics of the elongation barely affect the curvatures. After sufficient time passes, the trajectories indeed tend to the set of stable equilibria $\Omega$.

\subsection{Experimental platform}
\noindent Before validating the one-link dynamic model, we detail the experimental setup and control platform of the soft robotic system. We would like to briefly emphasize that sensing is a challenging topic soft robotics, due large continuous deformations and the presence of sensors that might affect the system's dynamics. As such, a combination of integrated sensors were used to recover an estimate of the states $\q \in \mathcal{Q}$. First of all, we employed a 9-DOF inertial measurement unit (Bosch, BNO055) measures the angular displacement of the soft robot's end-effector (i.e., $\sigma = L$). Through on-board sensor fusion, the bending angle of the soft robot can be recovered, i.e., $\beta = \kappa l$. Since the bending angle alone is not sufficient to decouple the curvature and elongation, additional sensing is required. Consequently, we used a vision sensor (\texttt{CreateLab}, \texttt{PixyCam2}) with an embedded processor (\texttt{NXP LPC44330}, 200 MHz) for optical tracking. A spherical optical marker is attached to the end-effector of the soft robot. Through trigonometry and the measured bending angle $\beta$, an estimate of the position vector $\gammaB(L,\q)$ can be recovered. Given the analytic expressions for the orientation and position in \eqref{eq:C2:phi_exact} and \eqref{eq:C2:pos_vector}, an inverse Jacobian kinematic solver is employed to recover an estimate of the state vector $\tvec{q}_d$.
During each experimental trail, it was made sure the soft robotic body does not occlude the optical marker.

As for the pneumatic actuation, an array of proportional-pressure regulators (Festo, VEAB-B-D16) was used with an active pressure range of $-0.1 \;\text{MPa}\, < \uB(t) \le 0.1 \; \textrm{MPa}$, which simultaneously allow for pressure measurements. These measurements are fed into the (quasi-static) model to also recover a quasi-static estimate of the states $\hat{q}_s$. Then, the dynamic estimates $\tvec{q}_{\textrm{dyn}}$ and the quasi-static pressure-based estimates $\tvec{q}_{\textrm{qs}}$ are fused using a complementary filter. The control and data acquisition are done using a \texttt{Raspberry Pi 4} (\texttt{2GB}). The full experimental setup can be seen in Figure \ref{fig:5}.

\begin{example}[Model validation -- unforced, forced, and external loads]
\noindent To validate the dynamic model, the solutions of the model are compared with measurements of the physical system in unforced,  forced, and tip-load conditions. As such, the model validation is separated into three parts: \textit{i)} unforced, \textit{ii)} forced conditions, and \textit{i)} external tip-loads applied on the end-effector. We start with the unforced scenario, \ie, no input is considered $u_i(t) \equiv 0$. For the unforced analysis, two experimental trails are performed for the unforced validation. First, the soft robot is deformed slightly and then released from rest, which corresponds to the initial conditions $\q_0 = \left(\;0.015,\,4.75,\,0\; \right)^\top$ and $\dq_0 = 0_3$. Since the mechanical deformations are relatively small here, the presence of hyper-elastic and visco-elastic material behavior are less dominant. Secondly, the soft robot is moderately deformed such that the initial configuration (or shortly after) lies within the hyper-elastic and visco-elastic regime. In this scenario, the nonlinear and time-dependent material effects may not be neglected. These initial conditions correspond to $\q_0 = \left(\;0.046,\,11.25,\,0\; \right)^\top$ and $\dot{{q}}_0 = 0_3$. It is worth mentioning that the creep strains $\lambda$ are difficult to distinguish from the true strain, and thus the initial conditions for $\lambda(t_0)$ are determined empirically. The validation results for both unforced scenario are shown in Figure \ref{fig:6}a. The associated code for the unforced validation simulations can be found under \texttt{./valid\_one\_link\_open.m}.
\end{example}

%
\begin{figure}[!t]
\centering
%\includegraphics[width = 0.95\textwidth]{CaasenbroodFig6.eps}
\caption{\textbf{(a)} Validation results of the
dynamic model in unforced conditions, where the dashed lines represent the experimental measurements and the solid lines are the simulated trajectories. \textbf{(b)} Validation results of the dynamic model in forced conditions, where the dashed lines represent the experimental data from the inertial sensor and the solid lines simulated. In addition, the figure also illustrates the model for Hookean elasticity and applied pressure inputs $u(t)$ to the dynamical system. It is evident from these comparison results that FEM-driven elasticity models can significantly improve accuracy. \textbf{(c)} Experimental validation of the one-link soft robot subjected to various end-effector payloads of different mass $m_\delta = \{0.05,\,0.1,\,0.15\}$ kg. \textbf{(d)} The quasi-static deformation produced by the hyper-elastic model under various end-effector loads. In both figures, the solid lines represent the dynamic model and the dashed lines are the experimental measurements. \label{fig:6}}
\end{figure}
%
As can be seen, the state trajectories of the end-effector closely match the ground truth trajectories, even for significant nonlinear deformation. For the first validation run (inside linear elastic regime), the RMS error and the maximum error are $\pm0.19$ and $\pm 0.50$ degrees, respectively. For the second case (outside the linear elastic regime), the RMS error and the maximum error is $\pm0.78$ and $\pm 2.33$ degrees, respectively.

Second, we consider a forced scenario in which a regulated pressure input is applied to the pneumatic bellows. Since the pneumatic mapping $H$ in \eqref{eq:mapping_H} plays an important role here, the actuator coefficients are recomputed to match the experimental data better. To be more specific, by considering a pre-defined set of excitation signals $u(t)$ of various amplitudes and frequencies, a least-squares optimization routine is employed that minimizes the difference between the measured states $\hat{q}$ with the simulated states ${q}$ by tuning the coefficients $\alpha_\varepsilon$ and $\alpha_\kappa$. This leads to the following values: $\alpha_\varepsilon = 2.34\cdot 10^{-7}$ and $\alpha_\kappa =  1.61\cdot 10^{-8}$. As for the excitation signal, we have chosen the following input:
%
\begin{equation}
u_i(t) = P_0 + P_A \left[\frac{1}{2} + \frac{1}{2}\sin(t + \phi_i) \right]\cdot \max(0.05t,1),
\end{equation}
%
with a static offset $P_0 = 10$ kPa, an amplitude $P_A = 25$ kPa, and a phase offset $\phi_i = (i-1)\frac{2\pi}{m}$ rad. To highlight the significance of the proposed hyper-elastic modeling approach, we also compare the results using an optimized Hookean material material model with $k_e = 50.6$ N/m and $k_b = 5.8\cdot 10^{-4}$ Nm/rad. The initial conditions are set to zero. The validations results for both the FEM-driven hyper-elasticity model and linear model in the forced setting are shown in Figure \ref{fig:6}b. The figure also shows the measured outputs from the pneumatic VEAB regulators $u_i(t)$, which are directly fed into both linear and hyper-elastic models. The associated code for the forced validation can be found under \texttt{./valid\_one\_link\_closed.m}.

Given these results, two key observations can be made. First, both the linear Hookean and hyper-elastic models provide reasonable accuracy for small deformations $0 \le \kappa(t) \le 3$ with a RMS error of $\pm0.13$ and $\pm0.16$ in curvature, respectively. However, as deformations exceed the linear regime, the hyper-elastic model significantly outperforms the Hookean model. Focusing on the hyper-elastic model, both the asymmetric stiffness in radial direction and the strain-hardening are captured well, where the the linear models is not sufficiently rich to capture the material effects. The overall RMS errors for the linear and hyper-elastic model are $\pm1.79$ and $\pm0.21$ in curvature, respectively. Regarding the end-effector accuracy, the overall RMS errors for the linear and hyper-elastic model are $\pm2.58$ and $\pm0.65$ mm, respectively; which translates to an arc-length normalized error of $\pm4.09\%$ and $\pm1.03\%$. These validations results show that introducing nonlinear elastic effects driven by FEM-data can further improve the accuracy for a larger region of the soft robot's workspace.

For the last validation case, we subject the soft robot to an external payload of mass $\delta_m$ located at the end-effector. To model the disturbance, we use the expression for the external payload disturbance model $\delta_m$ in \eqref{eq:delta_payload}. The goal here is \textit{i)} to demonstrate the accuracy of the proposed payload model and quasi-static behavior of the dynamic model, and \textit{ii)} to highlight the limitations of the PCC assumptions under certain conditions. In this analysis, we consider three different payloads $m_\delta = \{0.05,\,0.1,\,0.15\}$ kg.
The experimental results of the payloads deformations are shown in Figure \ref{fig:6}c, and the resulting quasi-static deformations of the dynamic model are shown in Figure \ref{fig:6}d. The associated code for the external payload simulations can be found under \texttt{./valid\_one\_link\_tipload.m}.

As can be seen, the quasi-static behavior of the dynamic model matches the experimental results relatively well for smaller payloads. For the mass $m_\delta = 0.05$ kg, the Euclidean error between the model and the measurement are $\pm1.31$ mm. Increasing the payload to $m_\delta = 0.1$ kg leads to an error of $\pm2.15$ mm. We can also clearly observe that the estimate of the backbone curve subject to the PCC condition is beginning to deviate from the ground truth yet the overall shape still matches the experimental data. Lastly, by further increase the payload $m_\delta = 0.15$ kg, we clearly observe the limitations of the PCC condition under external loads -- with an end-effector error of $3.98$ mm. Also, there is a clear discrepancy in the backbone curve of the model and the ground truth, which might imply the PCC condition is no longer valid here as the payload could induce non-constant curvatures along the backbone. A possible solution might be to introduce a different shape parametrization, similar to the works \cite{Chirikjian1994,Boyer2021,Renda2020,DellaSantina2020}.

\begin{example}[Model benchmark -- Multi-link soft manipulator case]
\noindent In this section, we benchmark the proposed numerical integration scheme for a dynamic model of a six-link soft robot manipulator ($N = 6$). Here, we want to highlight that sufficient numerical speed can be obtained while preserving sufficient numerical precision. This is an important criteria for model-based control, as slow numerical models lack transferability from theory to application. As mentioned earlier, the numerical integration of the Lagrangian entities is the computational bottleneck. Although the MDE solver does aid with numerical performance; ultimately, using a balanced spatial and temporal discretization impacts real-time performance the most. Trivially, using larger stepsize -- both in space and time -- lead to a decrease in numerical precision; and in some cases numerical instability. In this benchmark, we investigate these effects by varying two solver parameters: the spatial stepsize of the explicit MDE solver denoted by $\Delta \sigma$ and the temporal stepsize of the implicit trapezoidal solver denoted by $\Delta t$. For convenience, we represent these stepsizes as standardized parameters: the number of finite elements $N_s = L/\Delta \sigma$ and the implicit solver frequency $f_s = \Delta t\inv$. For the benchmark, we choose a total length of $L = 0.15$ m and simulation time of $T = 10$ s.
\end{example}

%
The extension to the multi-link soft robot ($N = 6$) can be described by a following generalized coordinates with the following structure:
%
\begin{equation}
\q = \left(\,\varepsilon_1,\,\kappa_{x,1},\kappa_{y,1},...,\varepsilon_6,\,\kappa_{x,6},\kappa_{y,6} \, \right)^\top \in \mathcal{Q}
\end{equation}
%
To ensure the soft manipulator is self-supporting, we introduce slight variations to the hyper-elastic stiffness, link lengths, and the inertial properties of the dynamical system. Considering homogeneity, all links are chosen identical in length and mass: intrinsic link length $L_i = 0.025$ m and mass $m_i = 0.05$ kg. Next, the bending stiffness is slightly altered where we choose $\alpha_3 = 0.425$ Nm/rad and $\alpha_4 = 0.4$ Nm/rad. Please note that the material domain is now given by $\Xs = [0,\sum^N_{i=1} L_i]$. To introduce some interesting dynamics for the benchmark, we purely excite the first link of the serial-chain soft robot manipulator with a harmonic input:
%
\begin{align}
u_i(t) = \begin{cases}
P_a \cos(t) & \text{for} \; i = 1, \\
0 & \text{otherwise},
\label{eq:harm_freq}
\end{cases}
\end{align}
%
where $P_a = 125$ kPa is the pressure amplitude. As for the pneumatic mapping that converts pressure to joint torques, we choose $\tau = \left(H \otimes I_6 \right)u $ as the corresponding pneumatic map for the six-link soft manipulator. In total 36 benchmark simulations with different solver settings were performed and tested for their precision relative to a high-precision model ($f_s = 500$ Hz and $N_s = 500$). The state trajectories of the high-precision model are shown in Figure \ref{fig:7}a, whereas Figure \ref{fig:7}b is provided to highlight the underlying dynamics and the trajectory of the end-effector. The results for all benchmark simulations are shown in Table \ref{tab:benchmark_table}. The associated code for the six-link simulations can be found under \texttt{./benchmark\_six\_link.m} on the repository.

%
\begin{figure}[!t]
\centering
%\includegraphics[width =0.475\textwidth]{CaasenbroodFig7.eps}
\caption{\textbf{(a)} State trajectories of six-link soft robot model under dynamic excitation. The figure shows the extensible elongation strains and the total curvature $\kappa = \sqrt{\kappa_x^2 + \kappa_x^2}$ (as the dynamics are planar). \textbf{(b)} The three-dimensional representation of the end-effector trajectory of the six-link soft robot. Notice that the dynamics of the six-link robot converge to a periodic solution. \label{fig:7}}
\end{figure}

Let us first discuss the dynamics of the six-link soft manipulator subjected to a harmonic input. Given this relatively straightforward harmonic excitation, some interesting (stable) nonlinear dynamics appear. Although we excite the system using one harmonic, the dynamics of the soft robot show a rich collection of harmonic oscillations -- highlighting its nonlinear nature. Furthermore, after a short transient time (i.e., $t < 5$), the solutions of the multi-link soft robotic system tend to a so-called \emph{periodic solution}. Here, a solution is called periodic if there exists a period time $T_c >  0$ such that $\q(t) = \q(t + T_c)$ for all time $t$. Similar observations of the existence of periodic solutions (and control of such oscillations) were reported by Della Santina et al. \cite{Santina2021} for articulated soft robots. Given the harmonic excitation in \eqref{eq:harm_freq}, the period time here is $T_c = 1$.

Now, we can exploit these periodic solutions for benchmarking the numerical solver in which we compare the solution of a high-resolution model (i.e., ground truth) to the benchmark solution. Let us define the benchmark error as the Euclidean distance between the two periodic solutions:
%
\begin{align}
e & = \int^{T_c}_0 || \,^0\hat{p}(q(t),L) - \,^0p(q(t),L) || \; dt, \notag \\ & \approx \frac{1}{W}\sum_{i = 1}^{W} || \,^0\hat{p}(q(t_i),L) - \,^0p(q(t_i),L)) ||,
\end{align}
%
where $W$ is the number of time samples of the benchmark model inside the time interval of the periodic solution, and $^0\hat{p}(\cdot,L)$ and $^0p(\cdot,L)$ the tip position of the benchmark and the ground truth, respectively. The index $W$ naturally depends on the sampling frequency of the implicit solver. Table 2 shows the normalized errors (i.e., the tracking error $e$ normalized with the manipulator length $L$) together with the effective computation times of the numerical solver.
\clearpage


\begin{sidewaystable}[!t]
% \begin{landscape}
% \begin{table}
\caption{Benchmark results of the six-link soft robot manipulator for various temporal and spatial discretizations ($T =10$ s). The tables shows the mean tracking error of the end-effector relative to a ground truth ($f_s = 500$ Hz and $N_s = 500$ elements). The RMS errors are normalized with the total length $L = 0.15$ (i.e., the errors are presented in $\%$). The CPU times are also given; where the light-gray entries achieve real-time computation (consistently).  \label{tab:benchmark_table}}
\centering

\begin{tabular}{l|lllllll}
%\toprule
$N = 6$ s  & $N_s = 24$ & $N_s =36$ &  $N_s =60$ &  $N_s = 90$ & $N_s = 120$ & $N_s =180$ \\[0.15em]
%\midrule
$f_s = 25$ Hz &  \textcolor{deepcolor}{\small{19.0 / 1.77s }} &  \textcolor{deepcolor}{\small{9.37 / 2.54s }} & \textcolor{deepcolor}{\small{5.36 / 4.06s }} &  \textcolor{deepcolor}{\small{4.63 / 5.98s }} &  \textcolor{deepcolor}{\small{4.62 / 7.93s}} & \small{4.43 / 11.75s } \\ [0.5em]
$f_s = 50$ Hz &  \textcolor{deepcolor}{\small{17.5 / 3.50s }} &  \textcolor{deepcolor}{\small{7.04 / 5.04s }} &  \textcolor{deepcolor}{\small{4.33 / 6.73s}} & \small{3.69 / 11.60s } & \small{3.60 / 15.3s} & \small{3.69 / 22.71s } \\ [0.5em]
$f_s = 75$ Hz &  \textcolor{deepcolor}{\small{13.77 / 5.31s}} &  \textcolor{deepcolor}{\small{5.80 / 7.56s}} & \small{4.51 / 12.41s} & \small{4.22 / 17.49s} & \small{3.68 / 22.35s} & \small{3.72 / 33.33s} \\ [0.5em]
$f_s = 100$ Hz &  \textcolor{deepcolor}{\small{14.73 / 6.48s}} &  \textcolor{deepcolor}{\small{6.12 / 9.10s}} & \small{4.42 / 14.54s} & \small{3.71 / 21.46s} & \small{3.53 / 28.35s} & \small{2.89 / 42.03s} \\ [0.5em]
$f_s = 150$ Hz &  \textcolor{deepcolor}{\small{15.22 / 7.26s}} &  \textcolor{deepcolor}{\small{5.73 / 9.78s}} & \small{4.32 / 15.58s} & \small{3.46 / 23.07s} & \small{3.16 / 30.38s } & \small{2.67 / 45.06s } \\ [0.5em]
$f_s = 250$ Hz & {\small{14.61 / 11.98s}} & \small{5.32 / 16.71s} & \small{4.14 / 27.11s} & \small{3.35 / 40.19s} & \small{2.86 / 53.06s } & \small{2.21 / 78.61s } \\[0.5em]
%\bottomrule
\end{tabular}
\end{sidewaystable}
%\begin{landscape}

\clearpage
The benchmark table above gives some useful insight into which settings benefit numerical precision and speed the most. First, regarding the coarser models $N = 24$ (i.e., 4 elements per link), we observe large numerical errors of $>\!10\%$ independent of solver frequency. Although one could argue these settings grantee real-time performance (2s of simulation time for 1s computation at $N_s = 24$, $f_s = 75$ Hz) and might suffice for model-based control in slow settings (i.e., set-point stabilization), they are most likely unsuited for dynamic tracking objectives. Moving towards $N_s = 60$ (i.e., 10 elements per link), we observe a significant improvement in numerical precision $\pm4\%$ and while still retaining real-time performance (1.6s of simulation time for 1s computation time at $f_s = 50$ Hz). As such, these settings show that both numerical precision and real-time computation can be achieved for more complicated multi-links soft robots. However, regarding the high-accuracy models $N_s > 100$, we see only a slight increase in numerical precision $\pm3\%$ yet lose real-time capabilities. Consequently, these models might be suited for offline simulations, but lack transferability to online model-based control. However, a possible solution here might be to convert the \texttt{MATLAB} model into a \texttt{C} or \texttt{C++} equivalent model to further increase numerical speed \cite{Grazioso2019,Sadati2020}.

\begin{example}[Closed-loop control -- Passivity-based controller under material certainty and mass disturbance]
\noindent In the last numerical analysis, we demonstrate the results of the proposed passivity-based adaptive scheme. Due to its compactness and computational speed, we again consider the model of the one-link soft robot as seen in previous simulations. To illustrate the robustness of the controller, we purposely introduce some uncertainties. First, we introduce uncertainties in the hyper-elastic material parameters that deviate moderately from their true values in Table 1. Second, we introduce a payload to the end-effector of mass $m_\delta = 0.1$ kg. We again model this external disturbance using the relation in \eqref{eq:delta_payload}. Following the linear parametrizability of the uncertainties, the parameter estimation vector yields:
\end{example}
%
\begin{equation}
\tvec{\pi}(t) = \left( \tilde{\alpha}_1,\,\tilde{\alpha}_2,\,\tilde{\alpha}_4,\, \tilde{\alpha}_5,\, \tilde{m}_\delta\right)^\top,
\end{equation}
%
with initial conditions $\tvec{\pi}(t_0) = \tvec{\pi}_0 = \left(0.75 {\alpha}_1,\,0.75{\alpha}_2,\,0.45{\alpha}_4,\, 0.45{\alpha}_5,\, 0.65{m}_\delta\right)^\top$. Furthermore, the feedback gains and the adaptation rate are chosen as diagonal matrices as follows $K_p = \text{diag}(5,5\text{e-}5,5\text{e-}5)
$, $K_d = \text{diag}(1,1\text{e-}5,1\text{e-}5)$, $\Lambda = I_3$, and $K_\Pi =  \text{diag}(5\text{e}3,5\text{e}3,2\text{e-}6,2\text{e-}6,2\text{e-}2)$. These values were found to yield the best performance while avoiding noticeable oscillations in the closed-loop dynamics. Lastly, the following reference trajectory is considered:
%
\begin{equation}
\q_d(t) = \left(0.01 + 0.01\,\sin(t),\, 30 \,\sin(t),\, 30 \,\cos(t)\right)^\top,
\end{equation}
%
Since the reference trajectory above satisfies persistence of
excitation (see Remark 2), it should grantee the all convergence of the hyper-elastic material estimation and the unknown mass contribution. Figure \ref{fig:8}a shows the state trajectories of the soft robot, Figure \ref{fig:8}b is provided to better illustrate the underlying dynamics of the controller, and Figure \ref{fig:9} shows the evolution of the nonlinear stiffnesses estimates, $\hat{k}_e(q,\hat{\Pi})$ and $\hat{k_b}(q,\hat{\Pi})$, respectively; and the payload estimate $\hat{m}_\delta(\hat{\Pi})$.

%
\begin{figure}[!t]
  \vspace{-5mm}
  \centering
  \input{./3_chapters/2_chapter/img/fig_C2_PBA_states.tex}
  \vspace{-3mm}
  \caption{State trajectories of soft robot with the passivity-based adaptive controller in \eqref{eq:C2:tau}. The figure shows the elongation strains and the curvatures in the $xz$-plane and $yz$-plane, respectively.}
  \label{fig:C2:natural_states}
\end{figure}
%

%
%\begin{figure}[!t]
%\centering

% %\includegraphics[width =0.475\textwidth,draft]{CaasenbroodFig8.eps}
% \caption{\textbf{(a)} State trajectories of soft robot with the passivity-based adaptive controller in \eqref{eq:tau}. The figure shows the elongation strains and the curvatures in the $xz$-plane and $yz$-plane, respectively. \textbf{(b)} The three-dimensional representation of the trajectory of the one-link soft robot and its end-effector. The proposed
% adaptive controller achieves almost perfect tracking, despite the uncertainties the material model and the presence of a payload $m_\delta$.\label{fig:8}}
% \end{figure}

%
\begin{figure}[!t]
\centering
%\includegraphics[width =0.55\textwidth]{CaasenbroodFig9.eps}
\caption{The evolution of the elongation stiffness estimate and bending stiffness estimate, ${k}_e(q,\hat{\Pi})$ and ${k}_b(q,\hat{\Pi})$ respectively; and the estimate of the payload $\hat{m}_\delta$. For illustration, the estimates are normalized with their true value, where we can see they slowly approach one after sufficient time passes.\label{fig:9}}
\end{figure}

As can be seen in Fig. \ref{fig:8} and Fig. \ref{fig:9}, the passivity-based controller offers good performance in the face of material uncertainties and external disturbances. The RMS tracking error in steady-state (i.e, $t \ge 30$s) between the desired end-effector trajectory and true trajectory is $\pm0.77$ mm; which translates to an arc-length normalized error of $\pm1.22\%$. Despite the presence of uncertainties, the passivity-based controller also ensures the states converges to the desired trajectory with a smooth transient. Regarding the results of Figure 9, the (nonlinear) stiffness estimates ${k}_e(q,\hat{\Pi})$ and $k_b(q,\hat{\Pi})$, and the unknown payload mass $\hat{m}_\delta$ slowly converge to the their true values. It should be mentioned that increasing the adaption rate leads to undesired (but bounded) oscillations of the estimates rather than faster convergences, therefore negatively affects the controller’s performance.
